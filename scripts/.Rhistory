dplyr::mutate(SV_type = ifelse(strain_occur %in% c(13, 21), "INVsosi1", "single_eri67"))
# to polinton
SA_XA_bref_DL238_yALT3 <- wgs_split_reads_bin  %>%
dplyr::filter(SA_bin_chr == "I",
SA_read_pos > 10302516,
SA_read_pos < 10319657) %>%
dplyr::filter(!(read_pos >= 4456378 & read_pos <= 4457096)) %>%
dplyr::filter(!(read_pos >= 4459211 & read_pos <= 4459920)) %>%
dplyr::distinct(strain, read_id, SA_bin_chr, SA_bin_start, bin_start) %>%
dplyr::group_by(strain, SA_bin_chr, SA_bin_start, bin_start) %>%
dplyr::add_count(name = "alt_count") %>%
dplyr::ungroup()  %>%
dplyr::filter(alt_count > 1) %>%
dplyr::left_join(wgs_split_reads_bin) %>%
dplyr::mutate(read_pos = read_pos + 5850692) %>%
dplyr::select(strain, read_pos, SA_read_pos) %>%
dplyr::distinct() %>%
dplyr::mutate(linegroup = row_number()) %>%
tidyr::gather(read, pos, -strain,-linegroup) %>%
dplyr::mutate(V8 = dplyr::case_when(read == "read_pos" ~ -0.03,
TRUE ~ -1.01)) %>%
dplyr::left_join(strain_SVassign)
WBTe738_fit <-
data.table::fread("../processed_data/WBTransposon00000738.tsv") %>%
dplyr::mutate(read_type = gsub(" ", "\n", read_type)) %>%
dplyr::filter(read_type == "Chimeric\nalignment")
# plot
plt_wgs_inv <- ggplot() + theme_cust +
theme(
legend.position = "none",
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = unit(c(2, .5, 0, 2), "mm"),
axis.text.y =  ggplot2::element_text(
size = font_size,
color = "black",
angle = 90,
vjust = 0.5,
hjust = 0.5
)
) +
geom_hline(
yintercept = c(1, 0, -1),
color = "grey",
linewidth = .2
) +
scale_color_manual(values = fix.color) +
geom_line(
data = wgs_split_reads_bin_I_inv_count2,
aes(
x = (pos + 5850692) / 1e6,
y = V8,
group = bin_range,
color = SV_type
),
linewidth = .5
) +
geom_line(
data = subset(SA_XA_bref_DL238_yALT3 , SV_type == "INVsosi1"),
aes(
x = pos / 1e6,
y = V8,
group = linegroup,
color = SV_type
) ,
size = .1
) +
geom_line(
data = subset(SA_XA_bref_DL238_yALT3, SV_type == "N2-like"),
aes(
x = pos / 1e6,
y = V8,
group = linegroup,
color = SV_type
) ,
size = .1
) +
geom_line(
data = subset(SA_XA_bref_DL238_yALT3, SV_type == "CB4856-like"),
aes(
x = pos / 1e6,
y = V8,
group = linegroup,
color = SV_type
) ,
size = .1
) +
geom_segment(
aes(
xend = (4457096 + 5850692) / 1e6,
x = (4456378 + 5850692) / 1e6,
y = 0,
yend = 0
),
size = .5 ,
color = "darkblue",
arrow = arrow(length = unit(0.01, "npc"))
)  +
geom_segment(
aes(
xend = (4459920 + 5850692) / 1e6,
x = (4459211 + 5850692) / 1e6,
y = 0,
yend = 0
),
size = .5 ,
color = "darkblue",
arrow = arrow(length = unit(0.01, "npc"))
) +
ggplot2::geom_rect(
data = N2cds_exon_eri67_1,
ggplot2::aes(
xmin = start2 / 1e6 ,
xmax = end2 / 1e6,
ymin = 1,
ymax = 1 ,
color = strand
),
size = 2
) +
ggplot2::geom_rect(
data = N2cds_exon_eri67_1,
ggplot2::aes(
xmin = start2 / 1e6 ,
xmax = end2 / 1e6,
ymin = 0,
ymax = 0 ,
color = strand
),
size = 2
) +
geom_segment(
aes(
xend = 10318008 / 1e6,
x = 10313744 / 1e6,
y = -1.05,
yend = -1.05
),
size = .5 ,
color = "lightpink2",
arrow = arrow(length = unit(0.01, "npc"))
)  +
geom_segment(
data = WBTe738_fit,
aes(
x = start / 1e6,
xend = end / 1e6,
y = -1,
yend = -1 ,
color = name
),
size = 1 ,
arrow = arrow(length = unit(0.02, "npc"))
) +
ylab("Split WGS reads mapped to ref-N2") +
xlab("Genomic regions on chromosome I") +
scale_x_continuous(
breaks = seq(4.450000 + 5.850692, 4.470000 + 5.850692, 0.005000)  ,
expand = c(0.0050, 0)
) +
scale_y_continuous(
breaks = c(-1, 0, 1),
limits = c(-1.1, 1.1),
labels = c(
"Chimeric\nalignment",
"Primary\nalignment" ,
"Chimeric\nalignment"
)
) +
geom_text(aes(
y = 1.1,
x = (2000 + 4451508 - 1 + 5850692) / 1e6,
label = "eri-7",
fontface = 3
), size = font_size * 5 / 14) +
geom_text(aes(
y = 1.1,
x = (6543 + 4451508 - 1 + 5850692) / 1e6,
label = "ERI-6 exons"
) , size = font_size * 5 / 14) +
geom_text(aes(
y = 1.1,
x = (9930 + 4451508 - 1 + 5850692) / 1e6,
label = "sosi-1",
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(aes(
y = 1.1,
x = (13031 + 4451508 - 1 + 5850692) / 1e6,
label = "eri-6[e]",
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(aes(
y = 1.1,
x = (14831 + 4451508 - 1 + 5850692) / 1e6,
label = "eri-6[f]",
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(aes(
y = -1.1  ,
x = 10310800 / 1e6,
label = "Polinton-1_CB",
fontface = 3
) ,
size = font_size * 5 / 14) +
geom_text(aes(
y = -1.1  ,
x = 10315744 / 1e6,
label = "pPolB1"
) , size = font_size * 5 / 14) +
geom_text(aes(
y = -1.1  ,
x = 10302816 / 1e6,
label = "TIR"
) , size = font_size * 5 / 14)  +
geom_text(aes(
y = -1.1  ,
x = 10319257 / 1e6,
label = "TIR"
) , size = font_size * 5 / 14) +
geom_text(aes(
y = 0.5  ,
x = (4455800 + 5850692) / 1e6,
label = "Single"
) , size = font_size * 5 / 14) +
geom_text(aes(
y = 0.5  ,
x = (4456800 + 5850692) / 1e6,
label = "eri-6-7" ,
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(
aes(
y = 0.38  ,
x = (4456100 + 5850692) / 1e6,
label = "93 strains"
) ,
size = font_size * 5 / 14,
color = "springgreen4"
) +
geom_text(aes(
y = 0.5  ,
x = (4461546 + 5850692) / 1e6,
label = "INVsosi-1"  ,
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(
aes(
y = 0.38  ,
x = (4462046 + 5850692) / 1e6,
label = "13 + 21 strains"
) ,
size = font_size * 5 / 14,
color = "purple"
)
#####  supp 10b  #####
load("../processed_data/I_4451194_4469460_perBase_coverage_SD_step200.RData")
zone_forDepth <-
data.table::fread("../processed_data/zone_forDepth.tsv") %>%
dplyr::mutate(
V8 = ifelse(zone == "eri6f_3UTR", -24, -22),
pos = (start + end) / 2e6,
pos = ifelse(
zone == "eri6f_3UTR",
pos + 0.0008,
ifelse(zone == "eri6f", pos - 0.0002, pos)
)
) %>%
dplyr::mutate(zone = gsub("TIR*", "DR", zone))
I_4451194_4469460_perBase_coverage3_mean <-
I_4451194_4469460_perBase_coverage3 %>%
dplyr::select(Pos_slide, mean_d2a, sd_d2a) %>%
dplyr::distinct()
coverage_color <- I_4451194_4469460_perBase_coverage3 %>%
dplyr::left_join(strain_SVassign) %>%
dplyr::filter(Pos_slide < 4465193 | Pos_slide > 4465693)
coverage_color$SV_type2 <- factor(
coverage_color$SV_type,
levels = c("single_eri67", "CB4856-like", "N2-like", "INVsosi1"),
labels = c(
"single_eri67\n(92 strains)",
"CB4856-like\n(20 strains)",
"N2-like\n(394 strains)",
"INVsosi-1\n(44 strains)"
)
)
plt_coverage <- ggplot() +
geom_line(
data = subset(coverage_color, SV_type %in% c("N2-like")),
aes(
x = Pos_slide / 1e6,
y = depth_window,
group = isotype,
color = SV_type
) ,
size = .1,
alpha = 0.5
) +
geom_line(
data = subset(coverage_color, SV_type %in% c("single_eri67")),
aes(
x = Pos_slide / 1e6,
y = depth_window,
group = isotype,
color = SV_type
) ,
size = .1,
alpha = 0.5
) +
geom_line(
data = subset(coverage_color, SV_type %in% c("INVsosi1")),
aes(
x = Pos_slide / 1e6,
y = depth_window,
group = isotype,
color = SV_type
) ,
size = .1,
alpha = 0.5
) +
geom_line(
data = subset(coverage_color, SV_type %in% c("CB4856-like")),
aes(
x = Pos_slide / 1e6,
y = depth_window,
group = isotype,
color = SV_type
) ,
size = .1,
alpha = 0.5
) +
# facet_grid( SV_type2~.)+
ggplot2::geom_rect(
data = subset(N2cds_exon_eri67_1, strand == "+"),
ggplot2::aes(
xmin = start / 1e6 ,
xmax = end / 1e6,
ymin = -20,
ymax = -20
),
color = "magenta" ,
size = 3
) +
ggplot2::geom_rect(
data = subset(N2cds_exon_eri67_1, strand == "-"),
ggplot2::aes(
xmin = start / 1e6 ,
xmax = end / 1e6,
ymin = -20,
ymax = -20
),
color = "lightskyblue" ,
size = 3
)  +
scale_color_manual(values = fix.color,
name = "Haplotype") +
theme_cust +
theme(legend.position = "none", plot.margin = unit(c(2, .5, 0, 2), "mm")) +
scale_x_continuous(breaks = seq(4.450000, 4.470000, 0.005000)  ,
expand = c(0, 0)) +
xlab("Genomic position (Mb) on chromosome I") +
ylab("Relative coverage") +
geom_segment(
data = zone_forDepth,
aes(
xend = start / 1e6,
x = end / 1e6,
y = V8 - 14,
yend = V8 - 14
),
size = 0.5
) +
geom_text(aes(
y = -52,
x = (2000 + 4451508 - 1) / 1e6,
label = "eri-7",
fontface = 3
), size = font_size * 5 / 14) +
geom_text(aes(
y = -52,
x = (6543 + 4451508 - 1) / 1e6,
label = "ERI-6 exons"
) , size = font_size * 5 / 14) +
geom_text(aes(
y = -52,
x = (9930 + 4451508 - 1) / 1e6,
label = "sosi-1",
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(aes(
y = -52,
x = (13031 + 4451508 - 1) / 1e6,
label = "eri-6[e]",
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(aes(
y = -52,
x = (14631 + 4451508 - 1) / 1e6,
label = "eri-6[f]",
fontface = 3
) , size = font_size * 5 / 14) +
geom_text(aes(
y = -54,
x = (15531 + 4451508 - 1) / 1e6,
label = "3'UTR"
) , size = font_size * 5 / 14) +
geom_text(aes(y = -54, x = 4.456737, label = "DR-L") , size = font_size *
5 / 14) +
geom_text(aes(y = -54, x = 4.459566, label = "DR-R") , size = font_size *
5 / 14)
#####  supp 10c  #####
I_4451194_4469460_perBase_coverage_zone <-
data.table::fread("../processed_data/I_4451194_4469460_zone_meanCoverage_step.tsv") %>%
dplyr::mutate(zone = ifelse(zone == "eri6f3utr", "eri6f_3UTR", zone))  %>%
dplyr::group_by(zone) %>%
dplyr::arrange(zone_mean) %>%
dplyr::mutate(st_ord = row_number()) %>%
dplyr::ungroup() %>%
dplyr::mutate(
zone = gsub("TIR*", "DR", zone),
zone = ifelse(zone == "sosi1", "sosi-1", zone),
zone = ifelse(zone == "eri-6[e]", "sosi-1", zone),
zone = ifelse(zone == "sosi1", "sosi-1", zone)
) %>%
dplyr::left_join(strain_SVassign)
dr12_depth <- I_4451194_4469460_perBase_coverage_zone %>%
dplyr::filter(grepl("DR", zone)) %>%
dplyr::select(strain, zone, zone_mean, SV_type) %>%
tidyr::spread(zone, zone_mean)
plt_dr12_depth <- ggplot(dr12_depth, aes(x = DR1, y = DR2, color = SV_type)) +
geom_point(size = .5) +
theme_cust +
scale_color_manual(values = fix.color) +
theme(legend.position = "none",
plot.margin = unit(c(2, .5, 0, 2), "mm")) +
ylab("Mean coverage in DR-R") +
xlab("Mean coverage in DR-L")
I_4451194_4469460_perBase_coverage_zone$zone2 <-
factor(
I_4451194_4469460_perBase_coverage_zone$zone,
levels =   c("DR1", "DR2", "sosi-1", "eri6e", "eri6f", "eri6f_3UTR"),
labels = c(
"DR-L",
"DR-R",
"sosi-1",
"eri-6[e]",
"eri-6[f]",
"eri-6[f] 3'UTR"
)
)
plt_ext10c2 <-
ggplot(
data = subset(
I_4451194_4469460_perBase_coverage_zone,
zone %in% c("sosi-1", "eri6e", "eri6f", "eri6f_3UTR")
),
aes(x = st_ord, y = zone_mean)
) +
geom_jitter(position = position_jitter(0.3),
#shape=21,
size = 1,
aes(color = SV_type))  +
theme_cust +
facet_wrap(. ~ zone2 , scales = "free_y", nrow = 1)  +
scale_color_manual(values = fix.color) +
scale_fill_manual(values = fix.color) +
theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
strip.text = ggplot2::element_text(
size = font_size,
vjust = 1,
color = "black",
face = "italic"
),
legend.position = "none",
plot.margin = unit(c(2, .5, 0, 2), "mm")
) +
ylab("Mean coverage in each region") +
xlab("550 strains")
plt_ext10c <- cowplot::plot_grid(
plt_dr12_depth,
plt_ext10c2,
labels = c('', 'D'),
label_size = part_labels_size,
label_fontfamily = "Helvetica",
rel_widths = c(1.4, 4),
axis = "tb",
align = "h",
nrow = 1
)
#####
plt_supp10 <-
cowplot::plot_grid(
plt_wgs_inv,
plt_coverage,
plt_ext10c,
labels = c('A', 'B' , 'C'),
label_size = part_labels_size,
label_fontfamily = "Helvetica",
rel_heights = c(1, 1, 0.7),
axis = "lr",
# align = "v",
nrow = 3
)
ggsave(
plt_supp10,
filename = paste("../figures/plt_supp_10_", date_f, ".pdf", sep = ""),
units = "mm",
height = 170,
width = 180
)
